//@version=5
//Based off Turtle Trade Channels Indicator (TuTCI) & TSI
//author: @kivancozbilgic

indicator(title='Turtle Entries', shorttitle='Turtle Entries', overlay=true, timeframe='')

risk = input.float(2, minval = 0, step = 0.1)
longstop = ta.highest(20) - risk * ta.atr(20)
shortstop = ta.lowest(20) + risk * ta.atr(20)
p1 = plot(longstop, title='longstop', linewidth=1, color=color.new(color.green, 60),trackprice=true)
p2 = plot(shortstop, title='shortstop', linewidth=1, color=color.new(color.red, 60),trackprice=true)

length = input.int(20, 'Entry Length', minval=1)
len2 = input.int(10, 'Exit Length', minval=1)
showsignals = input(title='Show Entry/Exit Signals ?', defval=true)
highlighting = input(title='Highlighter On/Off ?', defval=true)

lower = ta.lowest(length)
upper = ta.highest(length)

up = ta.highest(high, length)
down = ta.lowest(low, length)
sup = ta.highest(high, len2)
sdown = ta.lowest(low, len2)

buySignal = high == upper[1] or ta.crossover(high, upper[1])
sellSignal = low == lower[1] or ta.crossover(lower[1], low)
buyExit = low == sdown[1] or ta.crossover(sdown[1], low)
sellExit = high == sup[1] or ta.crossover(high, sup[1])

O1 = ta.barssince(buySignal)
O2 = ta.barssince(sellSignal)
O3 = ta.barssince(buyExit)
O4 = ta.barssince(sellExit)

E1 = ta.barssince(buySignal[1])
E2 = ta.barssince(sellSignal[1])
E3 = ta.barssince(buyExit[1])
E4 = ta.barssince(sellExit[1])

plotshape(buySignal and O3 < O1[1] ? down : na, title='Long Entry', location=location.belowbar, style=shape.arrowup, size=size.tiny, color=color.new(color.green, 0))
plotshape(buySignal and showsignals and O3 < O1[1] ? down : na, title='Long', text='Long Entry', location=location.bottom, style=shape.labelup, size=size.tiny, color=color.new(color.green, 0), textcolor=color.new(color.white, 0))

plotshape(sellSignal and O4 < O2[1] ? up : na, title='Short Entry', location=location.abovebar, style=shape.arrowdown, size=size.tiny, color=color.new(color.red, 0))
plotshape(sellSignal and showsignals and O4 < O2[1] ? up : na, title='Short', text='Short Entry', location=location.top, style=shape.labeldown, size=size.tiny, color=color.new(color.red, 0), textcolor=color.new(color.white, 0))

plotshape(buyExit and O1 < O3[1] ? up : na, title='Long Exit', location=location.abovebar, style=shape.arrowdown, size=size.tiny, color=color.new(color.blue, 0))
plotshape(buyExit and showsignals and O1 < O3[1] ? up : na, title='Long Exit', text='Exit Long', location=location.top, style=shape.labeldown, size=size.tiny, color=color.new(color.blue, 0), textcolor=color.new(color.white, 0))

plotshape(sellExit and O2 < O4[1] ? down : na, title='Short Exit', location=location.belowbar, style=shape.arrowup, size=size.tiny, color=color.new(color.blue, 0))
plotshape(sellExit and showsignals and O2 < O4[1] ? down : na, title='Short Exit', text='Exit Short', location=location.bottom, style=shape.labelup, size=size.tiny, color=color.new(color.blue, 0), textcolor=color.new(color.white, 0))


